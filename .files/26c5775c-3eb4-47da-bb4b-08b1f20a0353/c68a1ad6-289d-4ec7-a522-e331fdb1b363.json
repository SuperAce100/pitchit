{"file_path": "create_doc.py", "response": "from google.oauth2 import service_account\nfrom googleapiclient.discovery import build\nimport datetime\nimport tempfile\nimport os\nimport citationlib\nimport concurrent.futures\nimport streamlit as st\n\ndef create_citation_list(references, output_format=citationlib.Format.PLAIN):\n    with concurrent.futures.ThreadPoolExecutor() as executor:\n        citations = list(executor.map(\n            lambda ref: citationlib.create_citation(ref, output_format=output_format),\n            references\n        ))\n    return citations\n\n\ndef create_document(paragraphs, thesis, title, references=None):\n\n    # Replace with your service account file and scope\n    SERVICE_ACCOUNT_FILE = \"./keys/writing-agents-2b3410302d32.json\"\n    SCOPES = [\"https://www.googleapis.com/auth/documents\", \"https://www.googleapis.com/auth/drive\"]\n\n    creds = service_account.Credentials.from_service_account_info(st.secrets.google)\n    docs_service = build(\"docs\", \"v1\", credentials=creds)\n    drive_service = build(\"drive\", \"v3\", credentials=creds)\n\n    # Sample data (replace with your own references)\n    author = \"Inkwell AI\"\n    date = datetime.date.today().strftime(\"%B %d, %Y\")\n    font = \"Source Serif 4\"\n\n    # Utility function to create styled insertText requests\n    def create_insert_request(index, text, bold=False, heading=None):\n        request = {\n            \"insertText\": {\n                \"location\": {\"index\": index},\n                \"text\": text\n            }\n        }\n        if bold or heading:\n            request[\"insertTextStyle\"] = {\n                \"style\": {\n                    \"bold\": bold,\n                    \"headingId\": heading\n                }\n            }\n        return request\n\n    # 1. Create a new Google Doc\n    new_doc = {\"title\": title}\n    created_doc = docs_service.documents().create(body=new_doc).execute()\n    doc_id = created_doc.get(\"documentId\")\n    print(f\"Created doc with ID: {doc_id}\")\n\n    # 2. Build batchUpdate requests to insert content\n    requests = []\n\n    # Insert title with custom HEADING_1 style\n    requests.append({\n        \"insertText\": {\n            \"location\": {\"index\": 1},\n            \"text\": title + \"\\n\\n\",\n        }\n    })\n    requests.append({\n        \"updateParagraphStyle\": {\n            \"range\": {\"startIndex\": 1, \"endIndex\": len(title) + 2},\n            \"paragraphStyle\": {\n                \"namedStyleType\": \"HEADING_1\",\n                \"alignment\": \"CENTER\",\n                \"spaceAbove\": {\"magnitude\": 18, \"unit\": \"PT\"},\n                \"spaceBelow\": {\"magnitude\": 12, \"unit\": \"PT\"}\n            },\n            \"fields\": \"namedStyleType,alignment,spaceAbove,spaceBelow\"\n        }\n    })\n    requests.append({\n        \"updateTextStyle\": {\n            \"range\": {\"startIndex\": 1, \"endIndex\": len(title) + 2},\n            \"textStyle\": {\n                \"fontSize\": {\"magnitude\": 24, \"unit\": \"PT\"},\n                \"foregroundColor\": {\"color\": {\"rgbColor\": {\"red\": 0.1, \"green\": 0.1, \"blue\": 0.1}}},\n                \"bold\": True,\n                \"weightedFontFamily\": {\"fontFamily\": font}\n            },\n            \"fields\": \"fontSize,foregroundColor,bold,weightedFontFamily\"\n        }\n    })\n\n    # Insert author and date with custom SUBTITLE style\n    metadata = f\"{author}\\n{date}\\n\\n\"\n    requests.append({\n        \"insertText\": {\n            \"location\": {\"index\": len(title) + 2},\n            \"text\": metadata\n        }\n    })\n    requests.append({\n        \"updateParagraphStyle\": {\n            \"range\": {\"startIndex\": len(title) + 2, \"endIndex\": len(title) + len(metadata) + 2},\n            \"paragraphStyle\": {\n                \"namedStyleType\": \"SUBTITLE\",\n                \"alignment\": \"CENTER\",\n                \"spaceBelow\": {\"magnitude\": 18, \"unit\": \"PT\"},\n            },\n            \"fields\": \"namedStyleType,alignment,spaceBelow\"\n        }\n    })\n    requests.append({\n        \"updateTextStyle\": {\n            \"range\": {\"startIndex\": len(title) + 2, \"endIndex\": len(title) + len(metadata) + 2},\n            \"textStyle\": {\n                \"fontSize\": {\"magnitude\": 12, \"unit\": \"PT\"},\n                \"foregroundColor\": {\"color\": {\"rgbColor\": {\"red\": 0.4, \"green\": 0.4, \"blue\": 0.4}}},\n                \"italic\": True,\n                \"weightedFontFamily\": {\"fontFamily\": font}\n            },\n            \"fields\": \"fontSize,foregroundColor,italic,weightedFontFamily\"\n        }\n    })\n\n    # Insert thesis with NORMAL_TEXT style\n    thesis_label = \"Thesis:\\n\"\n    requests.append({\n        \"insertText\": {\n            \"location\": {\"index\": len(title) + len(metadata) + 2},\n            \"text\": thesis_label + thesis + \"\\n\\n\"\n        }\n    })\n    requests.append({\n        \"updateParagraphStyle\": {\n            \"range\": {\n                \"startIndex\": len(title) + len(metadata) + 2,\n                \"endIndex\": len(title) + len(metadata) + len(thesis_label) + len(thesis) + 4\n            },\n            \"paragraphStyle\": {\"namedStyleType\": \"NORMAL_TEXT\",\"alignment\": \"CENTER\"},\n            \"fields\": \"namedStyleType,alignment\"\n        }\n    })\n    requests.append({\n        \"updateTextStyle\": {\n            \"range\": {\n                \"startIndex\": len(title) + len(metadata) + 2,\n                \"endIndex\": len(title) + len(metadata) + len(thesis_label) + 2\n            },\n            \"textStyle\": {\"bold\": True, \"weightedFontFamily\": {\"fontFamily\": font}},\n            \"fields\": \"bold,weightedFontFamily\"\n        }\n    })\n    requests.append({\n        \"updateTextStyle\": {\n            \"range\": {\"startIndex\": len(title) + len(metadata) + len(thesis_label) + 2, \"endIndex\": len(title) + len(metadata) + len(thesis_label) + len(thesis) + 4},\n            \"textStyle\": {\"weightedFontFamily\": {\"fontFamily\": font}},\n            \"fields\": \"weightedFontFamily\"\n        }\n    })\n    \n    current_index = len(title) + len(metadata) + len(thesis_label) + len(thesis) + 4\n\n    # Add a line break and page break after thesis\n    requests.append({\n        \"insertText\": {\n            \"location\": {\"index\": current_index},\n            \"text\": \"\\n\"\n        }\n    })\n    requests.append({\n        \"insertPageBreak\": {\n            \"location\": {\"index\": current_index}\n        }\n    })\n\n    current_index += 1\n\n    # Insert paragraphs with NORMAL_TEXT style\n    for paragraph in paragraphs:\n        start_index = current_index\n        requests.append({\n            \"insertText\": {\n                \"location\": {\"index\": current_index},\n                \"text\": paragraph + \"\\n\\n\"\n            }\n        })\n        requests.append({\n            \"updateParagraphStyle\": {\n                \"range\": {\n                    \"startIndex\": start_index,\n                    \"endIndex\": start_index + len(paragraph) + 2\n                },\n                \"paragraphStyle\": {\"namedStyleType\": \"NORMAL_TEXT\"},\n                \"fields\": \"namedStyleType\"\n            }\n        })\n        requests.append({\n            \"updateTextStyle\": {\n                \"range\": {\"startIndex\": start_index, \"endIndex\": start_index + len(paragraph) + 2},\n                \"textStyle\": {\"weightedFontFamily\": {\"fontFamily\": font}},\n                \"fields\": \"weightedFontFamily\"\n            }\n        })\n        current_index += len(paragraph) + 2\n\n    # Add References section with HEADING_2 style\n    if references and len(references) > 0:\n        # Add a line break and page break before references\n        requests.append({\n            \"insertText\": {\n                \"location\": {\"index\": current_index},\n                \"text\": \"\\n\"\n            }\n        })\n        requests.append({\n            \"insertPageBreak\": {\n                \"location\": {\"index\": current_index}\n            }\n        })\n        current_index += 1\n\n        # Add References header\n        references_header = \"References\\n\\n\"\n        requests.append({\n            \"insertText\": {\n                \"location\": {\"index\": current_index},\n                \"text\": references_header\n            }\n        })\n        requests.append({\n            \"updateParagraphStyle\": {\n                \"range\": {\n                    \"startIndex\": current_index,\n                    \"endIndex\": current_index + len(references_header)\n                },\n                \"paragraphStyle\": {\n                    \"namedStyleType\": \"HEADING_2\",\n                    \"alignment\": \"START\",\n                    \"spaceAbove\": {\"magnitude\": 24, \"unit\": \"PT\"},\n                },\n                \"fields\": \"namedStyleType,alignment,spaceAbove\"\n            }\n        })\n        requests.append({\n            \"updateTextStyle\": {\n                \"range\": {\n                    \"startIndex\": current_index,\n                    \"endIndex\": current_index + len(\"References\")\n                },\n                \"textStyle\": {\n                    \"fontSize\": {\"magnitude\": 18, \"unit\": \"PT\"},\n                    \"foregroundColor\": {\"color\": {\"rgbColor\": {\"red\": 0.2, \"green\": 0.2, \"blue\": 0.2}}},\n                    \"bold\": True,\n                    \"weightedFontFamily\": {\"fontFamily\": font}\n                },\n                \"fields\": \"fontSize,foregroundColor,bold,weightedFontFamily\"\n            }\n        })\n        current_index += len(references_header)\n\n        # Add citations with NORMAL_TEXT style\n        citations = create_citation_list(references, output_format=citationlib.Format.PLAIN)\n        for i, citation in enumerate(citations, 1):\n            start_index = current_index\n            citation += \"\\n\\n\"\n            citation = citation.replace(\"<i>\", \"\")\n            citation = citation.replace(\"</i>\", \"\")\n            requests.append({\n                \"insertText\": {\n                    \"location\": {\"index\": current_index},\n                    \"text\": citation\n                }\n            })\n            requests.append({\n                \"updateParagraphStyle\": {\n                    \"range\": {\n                        \"startIndex\": start_index,\n                        \"endIndex\": start_index + len(citation)\n                    },\n                    \"paragraphStyle\": {\"namedStyleType\": \"NORMAL_TEXT\"},\n                    \"fields\": \"namedStyleType\"\n                }\n            })\n            requests.append({\n                \"updateTextStyle\": {\n                    \"range\": {\"startIndex\": start_index, \"endIndex\": start_index + len(citation)},\n                    \"textStyle\": {\"weightedFontFamily\": {\"fontFamily\": font}},\n                    \"fields\": \"weightedFontFamily\"\n                }\n            })\n            current_index += len(citation)\n\n    # 3. Send the update requests\n    docs_service.documents().batchUpdate(\n        documentId=doc_id,\n        body={\"requests\": requests}\n    ).execute()\n\n    # 4. Set document permissions\n    permission = {\n        \"type\": \"anyone\",  # Public access\n        \"role\": \"reader\"   # Read-only (use 'writer' for edit access)\n    }\n    drive_service.permissions().create(\n        fileId=doc_id,\n        body=permission\n    ).execute()\n\n    print(f\"Document created successfully! View it at: https://docs.google.com/document/d/{doc_id}/edit\")\n    return f\"https://docs.google.com/document/d/{doc_id}/edit\"\n\n\n\nif __name__ == \"__main__\":\n    paragraphs = [\n        \"In the realm of artificial intelligence and machine learning, the development of large language models has revolutionized the way we approach natural language processing tasks. These sophisticated systems, trained on vast corpora of text data, have demonstrated remarkable capabilities in understanding and generating human-like text across a wide range of domains and applications.\",\n        \"The architecture of these models typically involves multiple layers of neural networks, with transformer-based designs being particularly prominent in recent years. These architectures employ self-attention mechanisms that allow the model to weigh the importance of different words in a sentence, enabling more nuanced understanding and generation of contextually relevant text.\",\n        \"One of the most significant challenges in developing these models is the computational resources required for training. The process often necessitates the use of specialized hardware such as GPUs or TPUs, along with distributed computing frameworks to handle the massive scale of data and parameters involved in the training process.\",\n        \"Despite these challenges, the potential applications of large language models are vast and varied. They are being used in fields ranging from content creation and customer service to scientific research and education, demonstrating their versatility and impact across multiple sectors of society.\",\n        \"As we continue to develop and refine these models, it is crucial to consider the ethical implications of their use. Issues such as bias in training data, potential misuse of generated content, and the impact on employment in certain industries must be carefully addressed to ensure that the benefits of this technology are distributed equitably and responsibly.\"\n    ]\n    thesis = \"This is a test thesis.\"\n    title = \"Test Document\"\n    references = [\n        \"https://doi.org/10.1080/00461520.2012.722805\",\n        \"https://arxiv.org/abs/2401.03428\",\n        \"https://www.nytimes.com/2025/02/08/us/politics/treasury-systems-raised-security-concerns.html\"\n    ]\n    create_document(paragraphs=paragraphs, thesis=thesis, title=title, references=references)\n\n"}